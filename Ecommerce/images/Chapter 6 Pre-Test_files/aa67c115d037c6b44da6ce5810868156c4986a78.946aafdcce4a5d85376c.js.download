(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{OEhX:function(e,t,i){"use strict";i.d(t,"a",(function(){return D}));i("jm62"),i("ioFf"),i("rGqo"),i("yt8O"),i("Btvt"),i("RW0V");var s,a,c,n,r,o,h,l,u,v,p,d,b,f,w,y,g,m,P,O,j,k,z,x=i("rePB"),C=i("a3ss"),W=i("1OyB"),I=i("vuIU"),S=i("Y65e"),E=(i("+JCI"),i("2vnA")),T=function e(t){var i=t.x,s=t.y,a=t.w,c=t.h,n=t.solvedX,r=t.solvedY,o=t.rowX,h=t.rowY;Object(W.a)(this,e),this.x=i,this.y=s,this.w=a,this.h=c,this.solvedX=n,this.solvedY=r,this.visible=1,this.solved=0,this.offsetX=-1,this.offsetY=-1,this.rowX=o,this.rowY=h},H=i("obyI"),X=i("Gg0s");function Y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function M(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(i),!0).forEach((function(t){Object(x.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var D=(s=E.d.bound,a=E.d.bound,c=E.d.bound,n=E.d.bound,r=E.d.bound,o=function(){function e(t,i,s){Object(W.a)(this,e),Object(C.a)(this,"canvas",h,this),Object(C.a)(this,"ctx",l,this),Object(C.a)(this,"canvasWrapper",u,this),Object(C.a)(this,"canvasWidth",v,this),Object(C.a)(this,"canvasHeight",p,this),Object(C.a)(this,"savedCanvasWidth",d,this),Object(C.a)(this,"savedCanvasHeight",b,this),Object(C.a)(this,"idealWidth",f,this),Object(C.a)(this,"idealHeight",w,this),Object(C.a)(this,"columns",y,this),Object(C.a)(this,"rows",g,this),Object(C.a)(this,"puzzleImage",m,this),Object(C.a)(this,"pieces",P,this),Object(C.a)(this,"solvedPieces",O,this),Object(C.a)(this,"activePiece",j,this),Object(C.a)(this,"startCompleted",k,this),Object(C.a)(this,"resizeId",z,this),this.isInteractive=t,t?(this.playerStore=i,this.settingStore=s):this.startCompleted=!0}return Object(I.a)(e,[{key:"checkProgress",value:function(){var e=this;Object(E.e)((function(){return e.autoSaveStats(e.isCompleted)}))}},{key:"autoSaveStats",value:function(e){if(this.isInteractive&&this.solvedPieces.length&&this.playerStore.setHasAddedPuzzlePlayed(),e){var t=this.settingStore.getSettingValue("version"),i=this.settingStore.getPremiumValue("jigsaw","isTrackingStats");this.playerStore.autoSavePuzzle({},t,i)}}},{key:"init",value:function(e,t,i){var s=this,a=i.image,c=i.rows,n=i.columns;this.canvas=e,this.canvasWrapper=t,this.ctx=this.canvas.getContext("2d"),this.columns=n,this.rows=c;var r=new Image;r.onload=function(){return s.initPuzzle(r)},r.src=Object(X.a)(a),window.addEventListener("resize",(function(){clearTimeout(s.resizeId),s.resizeId=setTimeout(s.resizeCanvas,200)})),this.resizeCanvas()}},{key:"initPuzzle",value:function(e){this.puzzleImage=e,this.idealWidth=this.puzzleImage.width,this.idealHeight=this.puzzleImage.height,this.savedCanvasWidth=this.canvasWidth,this.savedCanvasHeight=this.canvasHeight,this.createPieces(),this.isInteractive&&this.setupEvents(),setInterval(this.drawPieces,10),this.resizeCanvas()}},{key:"drawPieces",value:function(){var e=this;this.clearCanvas(),this.solvedPieces.forEach((function(t){return e.drawPiece(t)})),this.pieces.forEach((function(t){return e.drawPiece(t)}))}},{key:"setPieceOutline",value:function(e){e?(this.ctx.lineWidth=0,this.ctx.strokeStyle="rgba(0,0,0,0)"):(this.ctx.lineWidth=2,this.ctx.strokeStyle="rgba(0,0,0,0.5)")}},{key:"drawTopEdge",value:function(e,t,i){e.rowY<=0||(t?this.drawTabOrBlank(e,0,i):this.drawTabOrBlank(e,0,!i))}},{key:"drawRightEdge",value:function(e,t,i){e.rowX>=this.columns-1||(t?this.drawTabOrBlank(e,1,!i):this.drawTabOrBlank(e,1,i))}},{key:"drawBottomEdge",value:function(e,t,i){e.rowY>=this.rows-1||(t?this.drawTabOrBlank(e,2,i):this.drawTabOrBlank(e,2,!i))}},{key:"drawLeftEdge",value:function(e,t,i){e.rowX<=0||(t?this.drawTabOrBlank(e,3,!i):this.drawTabOrBlank(e,3,i))}},{key:"drawPiece",value:function(e){var t=this.isEven(e.rowY),i=this.isEven(e.rowX);this.ctx.save(),this.setPieceOutline(e.solved),e.visible||(this.ctx.globalAlpha=.5),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.drawTopEdge(e,t,i),this.ctx.lineTo(e.x+e.w,e.y),this.drawRightEdge(e,t,i),this.ctx.lineTo(e.x+e.w,e.y+e.h),this.drawBottomEdge(e,t,i),this.ctx.lineTo(e.x,e.y+e.h),this.drawLeftEdge(e,t,i),this.ctx.lineTo(e.x,e.y),this.ctx.closePath(),this.ctx.clip(),this.ctx.drawImage(this.puzzleImage,0-e.solvedX+e.x,0-e.solvedY+e.y,this.canvasWidth,this.canvasHeight),this.ctx.stroke(),this.ctx.restore()}},{key:"drawTabOrBlank",value:function(e,t,i){var s=Math.min(e.h/6,e.w/6),a=0,c=0,n=0,r=0;switch(t){case 0:a=e.x+e.w/2,c=e.y,n=1*Math.PI,r=0*Math.PI;break;case 1:a=e.x+e.w,c=e.y+e.h/2,n=1.5*Math.PI,r=.5*Math.PI;break;case 2:a=e.x+e.w/2,c=e.y+e.h,n=0*Math.PI,r=1*Math.PI;break;case 3:a=e.x,c=e.y+e.h/2,n=.5*Math.PI,r=1.5*Math.PI}this.ctx.arc(a,c,s,n,r,i)}},{key:"initCanvasSize",value:function(){var e=this.canvasWrapper.offsetWidth,t=this.canvasWrapper.offsetHeight,i=this.calculateAspectRatio(this.idealWidth,this.idealHeight,e,t),s=i.w,a=i.h;this.canvas.width=this.canvasWidth=s,this.canvas.height=this.canvasHeight=a}},{key:"calculateAspectRatio",value:function(e,t,i,s){var a=Math.floor(s/t*e),c=Math.min(i,a);return{w:c,h:c/e*t}}},{key:"createPieces",value:function(){this.pieces=[],this.solvedPieces=[];for(var e=this.canvasWidth/this.columns,t=this.canvasHeight/this.rows,i=this.canvasWidth/100*10,s=(this.canvasWidth-e)/100*90,a=this.canvasHeight/100*10,c=(this.canvasHeight-t)/100*90,n=0;n<this.rows;n++)for(var r=0;r<this.columns;r++){var o=this.startCompleted?e*r:this.randomNumber(i,s),h=this.startCompleted?t*n:this.randomNumber(a,c),l=new T({x:o,y:h,w:e,h:t,solvedX:e*r,solvedY:t*n,rowX:r,rowY:n});this.pieces.push(l)}}},{key:"randomNumber",value:function(e,t){return Math.random()*(t-e)+e}},{key:"setupEvents",value:function(){var e=this,t=null!==document.ontouchstart?"mousedown":"touchstart";this.canvas.addEventListener(t,(function(t){t.preventDefault();var i=e.clickDown(t);e.clickPiece(i[0],i[1])}),!1);var i=null!==document.ontouchstart?"mouseup":"touchend";this.canvas.addEventListener(i,(function(){e.releasePiece()}),!1);var s=null!==document.ontouchstart?"mousemove":"touchmove";this.canvas.addEventListener(s,(function(t){-1!==e.activePiece&&e.movePiece(t)}),!1)}},{key:"clickDown",value:function(e){var t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;return"undefined"!==typeof e.changedTouches&&(i=e.changedTouches[0].pageX-t.left,s=e.changedTouches[0].clientY-t.top),[i,s]}},{key:"clickPiece",value:function(e,t){for(var i=this.pieces.length-1;i>=0;i--)if(this.checkCollision(this.pieces[i],e,t)){this.activePiece=i,this.hideAllPieces(),this.pieces[i].visible=1,this.pieces[i].offsetX=e-this.pieces[i].x,this.pieces[i].offsetY=t-this.pieces[i].y;break}}},{key:"checkCollision",value:function(e,t,i){return!e.solved&&(!(i>e.y+e.h)&&(!(i<e.y)&&(!(t>e.x+e.w)&&!(t<e.x))))}},{key:"hideAllPieces",value:function(){this.pieces=this.pieces.map((function(e){return M({},e,{visible:0})}))}},{key:"showAllPieces",value:function(){this.pieces=this.pieces.map((function(e){return M({},e,{visible:1})}))}},{key:"releasePiece",value:function(){if(-1!==this.activePiece){if(this.showAllPieces(),this.pieces[this.activePiece].offsetX=0,this.pieces[this.activePiece].offsetY=0,!this.checkSolved(this.pieces[this.activePiece])){var e=this.pieces[this.activePiece];this.pieces.splice(this.activePiece,1),this.pieces.push(e)}this.activePiece=-1}}},{key:"checkSolved",value:function(e){var t=0,i=e.x,s=e.y,a=e.solvedX,c=e.solvedY,n=this.canvasWidth/(3*this.columns),r=this.canvasHeight/(3*this.rows);if(Math.abs(i-a)<=n&&Math.abs(s-c)<=r){t=1,e.x=a,e.y=c,e.solved=1;var o=e;this.pieces.splice(this.activePiece,1),this.solvedPieces.push(o)}return t}},{key:"movePiece",value:function(e){var t=this.clickDown(e),i=this.pieces[this.activePiece],s=t[0]-i.offsetX,a=t[1]-i.offsetY,c=Math.min(Math.max(0,s),this.canvasWidth-i.w),n=Math.min(Math.max(0,a),this.canvasHeight-i.h);i.x=c,i.y=n}},{key:"isEven",value:function(e){return e%2==0}},{key:"clearCanvas",value:function(){this.canvas.width=this.canvas.width}},{key:"resizeCanvas",value:function(){this.initCanvasSize();for(var e=this.canvasWidth/this.savedCanvasWidth*100,t=this.canvasHeight/this.savedCanvasHeight*100,i=0;i<this.pieces.length;i++)this.pieces[i].x=this.pieces[i].x/100*e,this.pieces[i].y=this.pieces[i].y/100*t,this.pieces[i].w=this.pieces[i].w/100*e,this.pieces[i].h=this.pieces[i].h/100*t,this.pieces[i].solvedX=this.pieces[i].solvedX/100*e,this.pieces[i].solvedY=this.pieces[i].solvedY/100*t;for(var s=0;s<this.solvedPieces.length;s++)this.solvedPieces[s].x=this.solvedPieces[s].x/100*e,this.solvedPieces[s].y=this.solvedPieces[s].y/100*t,this.solvedPieces[s].w=this.solvedPieces[s].w/100*e,this.solvedPieces[s].h=this.solvedPieces[s].h/100*t,this.solvedPieces[s].solvedX=this.solvedPieces[s].solvedX/100*e,this.solvedPieces[s].solvedY=this.solvedPieces[s].solvedY/100*t;this.savedCanvasWidth=this.canvasWidth,this.savedCanvasHeight=this.canvasHeight}},{key:"isCompleted",get:function(){return this.solvedPieces.length&&!this.pieces.length}}]),e}(),h=Object(S.a)(o.prototype,"canvas",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=Object(S.a)(o.prototype,"ctx",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=Object(S.a)(o.prototype,"canvasWrapper",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=Object(S.a)(o.prototype,"canvasWidth",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p=Object(S.a)(o.prototype,"canvasHeight",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d=Object(S.a)(o.prototype,"savedCanvasWidth",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=Object(S.a)(o.prototype,"savedCanvasHeight",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f=Object(S.a)(o.prototype,"idealWidth",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),w=Object(S.a)(o.prototype,"idealHeight",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),y=Object(S.a)(o.prototype,"columns",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H.c.jigsaw.DEFAULT_SIZE}}),g=Object(S.a)(o.prototype,"rows",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H.c.jigsaw.DEFAULT_SIZE}}),m=Object(S.a)(o.prototype,"puzzleImage",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=Object(S.a)(o.prototype,"pieces",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O=Object(S.a)(o.prototype,"solvedPieces",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=Object(S.a)(o.prototype,"activePiece",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),k=Object(S.a)(o.prototype,"startCompleted",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z=Object(S.a)(o.prototype,"resizeId",[E.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Object(S.a)(o.prototype,"checkProgress",[s],Object.getOwnPropertyDescriptor(o.prototype,"checkProgress"),o.prototype),Object(S.a)(o.prototype,"autoSaveStats",[a],Object.getOwnPropertyDescriptor(o.prototype,"autoSaveStats"),o.prototype),Object(S.a)(o.prototype,"isCompleted",[E.f],Object.getOwnPropertyDescriptor(o.prototype,"isCompleted"),o.prototype),Object(S.a)(o.prototype,"drawPieces",[c],Object.getOwnPropertyDescriptor(o.prototype,"drawPieces"),o.prototype),Object(S.a)(o.prototype,"drawPiece",[n],Object.getOwnPropertyDescriptor(o.prototype,"drawPiece"),o.prototype),Object(S.a)(o.prototype,"resizeCanvas",[r],Object.getOwnPropertyDescriptor(o.prototype,"resizeCanvas"),o.prototype),o)}}]);